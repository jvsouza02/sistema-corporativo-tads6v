# REQ012 - Registrar Atendimento

**OBJETIVO:** Permitir que o barbeiro registre os serviços e produtos utilizados em um atendimento.  
**ATOR:** Barbeiro  
**PRIORIDADE:** Alta  

---

### PRÉ-CONDIÇÕES
- O barbeiro deve estar autenticado.
- Deve existir um agendamento para a barbearia do barbeiro ou um cliente deve ser selecionado para atendimento avulso.

### PÓS-CONDIÇÕES
- O atendimento é registrado com status "finalizado".
- O estoque é atualizado automaticamente com a baixa dos produtos utilizados.
- Se havia um agendamento associado, seu status é atualizado para "concluído".

---

### FLUXO PRINCIPAL
1. O barbeiro acessa a página de detalhes da barbearia.
2. O sistema mostra os agendamentos do dia com status "agendado".
3. O barbeiro seleciona um agendamento e clica em "Iniciar atendimento" ou inicia um atendimento sem agendamento.
4. O sistema mostra um formulário com os serviços disponíveis, produtos extras e campo para observações.
5. O barbeiro seleciona os serviços prestados.
6. O sistema carrega automaticamente os produtos padrão associados aos serviços selecionados.
7. O barbeiro adiciona produtos extras, se necessário.
8. O sistema calcula o valor total automaticamente a cada alteração.
9. O barbeiro adiciona comentários, se desejar.
10. O barbeiro confirma o registro do atendimento.
11. O sistema registra o atendimento com status "finalizado".
12. O sistema reduz a quantidade utilizada de cada produto do estoque da barbearia.
13. Se havia um agendamento associado, o sistema atualiza seu status para "concluído".

---

### FLUXOS DE EXCEÇÃO
1. **Dados Incompletos**  
1.1. O barbeiro tenta finalizar o atendimento sem ter selecionado nenhum serviço.  
1.2. O sistema impede o registro e solicita a seleção de pelo menos um serviço.  

2. **Estoque Insuficiente**  
2.1. A quantidade necessária de um produto para realizar os serviços selecionados não está disponível no estoque da barbearia.  
2.2. O sistema alerta o barbeiro sobre o produto em falta, impede o registro do atendimento e sugere a reposição do estoque ou alteração dos serviços.  

3. **Agendamento Não Pertence à Barbearia**  
3.1. O barbeiro tenta iniciar um atendimento a partir de um agendamento que está vinculado a outra barbearia (não a que ele está logado).  
3.2. O sistema impede o registro e informa que o agendamento não pode ser atendido naquela unidade.  

---

### REQUISITOS DE USUÁRIO RELACIONADOS
- **RF012 – Registrar Atendimento:** O sistema deve permitir ao barbeiro registrar atendimentos, selecionando os serviços prestados e seus produtos associados, adicionar produtos extras, incluir comentários e recalcular automaticamente o valor total a cada atualização, abatendo os produtos usados do estoque da barbearia.
- **RN002 – Atualizar estoque após atendimento:** A quantidade de produtos utilizada durante um atendimento é automaticamente subtraída do estoque disponível.
- **RN006 – Padronizar quantidade de produto por serviço:** A quantidade de cada produto usado em um serviço é medida e registrada em mililitros.
- **RN009 – Atualizar status do agendamento após atendimento:** Quando um atendimento é registrado a partir de um agendamento, o status do agendamento é alterado automaticamente para "concluído".
- **RN010 – Verificar propriedade do agendamento:** Garante que um agendamento pertence à barbearia onde o atendimento está sendo registrado.
